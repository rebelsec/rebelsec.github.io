<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Embed origin into PDF metadata</title>
</head>
<body>
  <button id="btn">Download PDF (with origin metadata)</button>

  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script>
    const url = "https://e-mental.ssdm.polri.go.id/emental/psikogram/7d48af8d-a74a-411a-b8c8-21c6471d4296%2B.pdf";
    document.getElementById('btn').addEventListener('click', async () => {
      try {
        const res = await fetch(url, { mode: 'cors' }); // CORS server must allow this
        if (!res.ok) throw new Error('Fetch failed: ' + res.status);
        const arrayBuffer = await res.arrayBuffer();

        // Load PDF dan ubah metadata
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        pdfDoc.setTitle('Psikogram');
        pdfDoc.setAuthor('e-mental.ssdm.polri.go.id');
        pdfDoc.setSubject('Psikogram + original source');
        // Set custom metadata (XMP) via setCreator / setProducer atau menyisipkan page text
        pdfDoc.setProducer('Original-URL: ' + url);

        // (Opsional) tambahkan halaman kecil dengan teks "Source: <url>"
        const pages = pdfDoc.getPages();
        const firstPage = pages[0];
        firstPage.drawText(`Source: ${url}`, {
          x: 10,
          y: 10,
          size: 8,
        });

        const modifiedBytes = await pdfDoc.save();
        const blob = new Blob([modifiedBytes], { type: 'application/pdf' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'psikogram;][]\`12`12`12`12.pdf';
        a.click();
        URL.revokeObjectURL(a.href);
      } catch (e) {
        alert('Gagal: ' + e.message + '. Mungkin server memblokir CORS.');
      }
    });
  </script>
</body>
</html>
