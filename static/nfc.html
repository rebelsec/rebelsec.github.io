<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3 Buttons: NFC / Fullscreen Sequences (PoC)</title>
  <style>
    :root{
      --bg:#f7fafc; --card:#ffffff; --accent:#0ea5a4; --muted:#6b7280;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }
    html,body{height:100%;margin:0;background:var(--bg);display:flex;align-items:center;justify-content:center}
    .card{width:420px;background:var(--card);border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.08);text-align:center}
    h1{font-size:16px;margin:0 0 8px}
    p.lead{margin:0 0 14px;color:var(--muted);font-size:13px}
    .btn-row{display:flex;gap:10px;justify-content:center;margin-bottom:10px}
    button{flex:1;padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    button.secondary{background:#2563eb}
    .status{margin-top:10px;font-size:13px;color:var(--muted);min-height:20px}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Sequence Buttons: NFC & Fullscreen</h1>
    <p class="lead">Use on Chrome for Android (HTTPS). Each button shows concise status updates.</p>

    <div class="btn-row">
      <button id="btnNfcOnly">NFC → wait 3s</button>
      <button id="btnFsOnly" class="secondary">Wait 3s → Fullscreen</button>
      <button id="btnNfcThenFs">NFC → (re-request) → wait 3s → Fullscreen</button>
    </div>

    <div id="status" class="status">Status: idle</div>
    <div class="note">Requirements: HTTPS (or localhost) + Chrome on Android with Web NFC support.</div>
  </div>

<script>
(() => {
  const btnNfcOnly = document.getElementById('btnNfcOnly');
  const btnFsOnly = document.getElementById('btnFsOnly');
  const btnNfcThenFs = document.getElementById('btnNfcThenFs');
  const statusEl = document.getElementById('status');
  const DELAY_MS = 3000;

  function setStatus(txt){
    statusEl.textContent = 'Status: ' + txt;
  }

  async function delay(ms){ return new Promise(res => setTimeout(res, ms)); }

  async function requestNfcOnce(){
    if (!('NDEFReader' in window)) {
      setStatus('Web NFC API not supported on this browser.');
      return { ok:false, err:'unsupported' };
    }

    try {
      setStatus('Requesting NFC permission (prompt)...');
      const reader = new NDEFReader();
      await reader.scan(); // triggers the permission prompt
      setStatus('NFC permission granted (scan started).');
      reader.onreading = () => setStatus('NFC tag read (event).');
      reader.onreadingerror = () => setStatus('NFC read error.');
      return { ok:true, reader };
    } catch (err) {
      console.error('NFC request error', err);
      if (err && err.name === 'NotAllowedError') setStatus('NFC permission denied by user.');
      else if (err && err.name === 'NotSupportedError') setStatus('NFC not available/disabled at OS level.');
      else if (err && (err.name === 'SecurityError' || err.name === 'NetworkError')) setStatus('HTTPS and top-level context required.');
      else setStatus('NFC request failed: ' + (err && (err.message || err.name) || 'unknown'));
      return { ok:false, err: err ? (err.name || err.message) : 'error' };
    }
  }

  async function enterFullscreen(){
    try {
      if (document.fullscreenElement) {
        setStatus('Already in fullscreen.');
        return true;
      }
      if (document.documentElement.requestFullscreen) {
        setStatus('Entering fullscreen...');
        await document.documentElement.requestFullscreen();
        setStatus('Entered fullscreen.');
        return true;
      } else {
        setStatus('Fullscreen API not supported.');
        return false;
      }
    } catch (e) {
      console.error('requestFullscreen error', e);
      setStatus('Failed to enter fullscreen: ' + (e.message || e.name));
      return false;
    }
  }

  // Button 1: NFC -> delay 3s
  btnNfcOnly.addEventListener('click', async () => {
    btnNfcOnly.disabled = true;
    const res = await requestNfcOnce();
    if (!res.ok) {
      btnNfcOnly.disabled = false;
      return;
    }
    setStatus('Waiting ' + (DELAY_MS/1000) + 's ...');
    await delay(DELAY_MS);
    setStatus('NFC sequence complete.');
    btnNfcOnly.disabled = false;
  });

  // Button 2: Wait 3s -> Fullscreen
  btnFsOnly.addEventListener('click', async () => {
    btnFsOnly.disabled = true;
    setStatus('Waiting ' + (DELAY_MS/1000) + 's before entering fullscreen...');
    await delay(DELAY_MS);
    const ok = await enterFullscreen();
    if (!ok) { btnFsOnly.disabled = false; return; }
    setStatus('Fullscreen sequence complete.');
    btnFsOnly.disabled = false;
  });

  // Button 3: NFC -> re-request NFC -> delay 3s -> Fullscreen
  btnNfcThenFs.addEventListener('click', async () => {
    btnNfcThenFs.disabled = true;
    // First NFC request
    const first = await requestNfcOnce();
    // Attempt a second NFC request (re-request)
    setStatus('Attempting re-request of NFC permission...');
    const second = await requestNfcOnce();

    // Wait delay
    setStatus('Waiting ' + (DELAY_MS/1000) + 's before entering fullscreen...');
    await delay(DELAY_MS);

    // Enter fullscreen after delay
    await enterFullscreen();

    setStatus('NFC→re-request→delay→fullscreen sequence finished.');
    btnNfcThenFs.disabled = false;
  });

  // Update status when user exits fullscreen
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) {
      setStatus('Exited fullscreen.');
    }
  });
})();
</script>
</body>
</html>
