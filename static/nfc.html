<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web NFC → Delay → Fullscreen (PoC)</title>
  <style>
    :root{
      --bg:#f3f4f6; --card:#fff; --accent:#0ea5a4; --muted:#6b7280;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);display:flex;align-items:center;justify-content:center}
    .card{width:360px;background:var(--card);border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.08);text-align:center}
    h1{font-size:18px;margin:0 0 8px}
    p.lead{margin:0 0 14px;color:var(--muted);font-size:13px}
    button{background:var(--accent);color:#fff;border:0;padding:12px 16px;border-radius:10px;font-weight:600;cursor:pointer}
    .status{margin-top:12px;font-size:13px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="card" role="main">
    wsad
    <h1>Web NFC → 5s Delay → Fullscreen</h1>
    <p class="lead">Click to request Web NFC permission first. After 5 seconds the page will enter fullscreen.</p>
    <button id="startBtn">Click to start</button>
    <div id="status" class="status">Status: idle</div>
    <div class="small">Requires HTTPS and Chrome for Android with Web NFC support.</div>
  </div>

<script>
(async function(){
  const btn = document.getElementById('startBtn');
  const statusEl = document.getElementById('status');
  const delayMs = 5000;

  function setStatus(t){ statusEl.textContent = 'Status: ' + t; }

  async function requestNfcPermission(){
    if (!('NDEFReader' in window)) {
      setStatus('Web NFC API not supported in this browser.');
      return { granted: false, reason: 'unsupported' };
    }

    try {
      setStatus('Requesting NFC permission (permission prompt)...');
      const reader = new NDEFReader();
      await reader.scan(); // triggers permission prompt
      setStatus('NFC permission granted (scan started).');
      // optional: attach handlers (not required for PoC)
      reader.onreading = () => setStatus('NFC tag read (event).');
      reader.onreadingerror = () => setStatus('NFC read error.');
      return { granted: true };
    } catch (err) {
      // NotAllowedError = user denied; NotSupportedError = NFC off; others = context/security
      console.error('NFC error', err);
      if (err.name === 'NotAllowedError') setStatus('NFC permission denied by user.');
      else if (err.name === 'NotSupportedError') setStatus('NFC unavailable or disabled on device.');
      else if (err.name === 'SecurityError' || err.name === 'NetworkError') setStatus('HTTPS/top-level context required.');
      else setStatus('NFC request failed: ' + (err.message || err.name));
      return { granted: false, reason: err.name || 'error' };
    }
  }

  async function enterFullscreen(){
    try {
      if (document.fullscreenElement) {
        setStatus('Already in fullscreen.');
        return true;
      }
      if (document.documentElement.requestFullscreen) {
        await document.documentElement.requestFullscreen();
        setStatus('Entered fullscreen.');
        return true;
      } else {
        setStatus('Fullscreen API not supported.');
        return false;
      }
    } catch (e) {
      console.error('requestFullscreen error', e);
      setStatus('Failed to enter fullscreen: ' + (e.message || e.name));
      return false;
    }
  }

  btn.addEventListener('click', async () => {
    btn.disabled = true;
    setStatus('Initiating NFC permission request...');
    // 1) Request NFC permission first (user gesture required)
    await requestNfcPermission();

    // 2) Wait delay (5s)
    setStatus('Waiting ' + (delayMs/1000) + 's before entering fullscreen...');
    await new Promise(r => setTimeout(r, delayMs));

    // 3) Enter fullscreen after delay regardless of NFC result
    await enterFullscreen();

    // re-enable button for further tries if desired
    btn.disabled = false;
  });

  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) setStatus('Exited fullscreen.');
  });
})();
</script>
</body>
</html>
